# Миграция на Claude 4.5

Руководство по миграции на Claude 4.5 с пошаговыми инструкциями и информацией о критических изменениях

---

Это руководство охватывает два ключевых пути миграции на модели Claude 4.5:

- **Claude Sonnet 3.7 → Claude Sonnet 4.5**: Наша самая интеллектуальная модель с лучшими в своём классе возможностями рассуждения, кодирования и долгосрочных агентов
- **Claude Haiku 3.5 → Claude Haiku 4.5**: Наша самая быстрая и интеллектуальная модель Haiku с производительностью, близкой к передовой, для приложений реального времени и высокообъёмной интеллектуальной обработки

Обе миграции включают критические изменения, которые требуют обновления вашей реализации. Это руководство проведёт вас через каждый путь миграции с пошаговыми инструкциями и чётко обозначенными критическими изменениями.

Перед началом миграции мы рекомендуем ознакомиться с [Что нового в Claude 4.5](/docs/ru/about-claude/models/whats-new-claude-4-5), чтобы понять новые функции и возможности, доступные в этих моделях, включая расширенное мышление, осведомлённость о контексте и улучшения поведения.

## Миграция с Claude Sonnet 3.7 на Claude Sonnet 4.5

Claude Sonnet 4.5 — это наша самая интеллектуальная модель, предлагающая лучшую в своём классе производительность для рассуждения, кодирования и долгосрочных автономных агентов. Эта миграция включает несколько критических изменений, которые требуют обновления вашей реализации.

### Шаги миграции

1. **Обновите имя модели:**
   ```python
   # До (Claude Sonnet 3.7)
   model="claude-3-7-sonnet-20250219"

   # После (Claude Sonnet 4.5)
   model="claude-sonnet-4-5-20250929"
   ```

2. **Обновите параметры выборки**

   <Warning>
   Это критическое изменение по сравнению с Claude Sonnet 3.7.
   </Warning>

   Используйте только `temperature` ИЛИ `top_p`, но не оба одновременно:

   ```python
   # До (Claude Sonnet 3.7) - Это вызовет ошибку в Sonnet 4.5
   response = client.messages.create(
       model="claude-3-7-sonnet-20250219",
       temperature=0.7,
       top_p=0.9,  # Невозможно использовать оба
       ...
   )

   # После (Claude Sonnet 4.5)
   response = client.messages.create(
       model="claude-sonnet-4-5-20250929",
       temperature=0.7,  # Используйте temperature ИЛИ top_p, но не оба
       ...
   )
   ```

3. **Обработайте новую причину остановки `refusal`**

   Обновите ваше приложение для [обработки причин остановки `refusal`](/docs/ru/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals):

   ```python
   response = client.messages.create(...)

   if response.stop_reason == "refusal":
       # Обработайте отказ надлежащим образом
       pass
   ```

4. **Обновите инструмент текстового редактора (если применимо)**

   <Warning>
   Это критическое изменение по сравнению с Claude Sonnet 3.7.
   </Warning>

   Обновите на `text_editor_20250728` (тип) и `str_replace_based_edit_tool` (имя). Удалите любой код, использующий команду `undo_edit`.
   
   ```python
   # До (Claude Sonnet 3.7)
   tools=[{"type": "text_editor_20250124", "name": "str_replace_editor"}]

   # После (Claude Sonnet 4.5)
   tools=[{"type": "text_editor_20250728", "name": "str_replace_based_edit_tool"}]
   ```

   Подробности см. в [документации инструмента текстового редактора](/docs/ru/agents-and-tools/tool-use/text-editor-tool).

5. **Обновите инструмент выполнения кода (если применимо)**

   Обновите до `code_execution_20250825`. Устаревшая версия `code_execution_20250522` по-прежнему работает, но не рекомендуется. Подробные инструкции по миграции см. в [документации инструмента выполнения кода](/docs/ru/agents-and-tools/tool-use/code-execution-tool#upgrade-to-latest-tool-version).

6. **Удалите заголовок бета-версии для экономного использования инструментов**

   Экономное использование инструментов — это функция бета-версии, которая работает только с Claude 3.7 Sonnet. Все модели Claude 4 имеют встроенное экономное использование инструментов, поэтому вам больше не следует включать заголовок бета-версии.

   Удалите заголовок бета-версии `token-efficient-tools-2025-02-19` [beta header](/docs/ru/api/beta-headers) из ваших запросов:

   ```python
   # До (Claude Sonnet 3.7)
   client.messages.create(
       model="claude-3-7-sonnet-20250219",
       betas=["token-efficient-tools-2025-02-19"],  # Удалите это
       ...
   )

   # После (Claude Sonnet 4.5)
   client.messages.create(
       model="claude-sonnet-4-5-20250929",
       # Нет заголовка бета-версии token-efficient-tools
       ...
   )
   ```

7. **Удалите заголовок бета-версии для расширенного вывода**

   Заголовок бета-версии `output-128k-2025-02-19` [beta header](/docs/ru/api/beta-headers) для расширенного вывода доступен только в Claude Sonnet 3.7.

   Удалите этот заголовок из ваших запросов:

   ```python
   # До (Claude Sonnet 3.7)
   client.messages.create(
       model="claude-3-7-sonnet-20250219",
       betas=["output-128k-2025-02-19"],  # Удалите это
       ...
   )

   # После (Claude Sonnet 4.5)
   client.messages.create(
       model="claude-sonnet-4-5-20250929",
       # Нет заголовка бета-версии output-128k
       ...
   )
   ```

8. **Обновите ваши подсказки с учётом изменений поведения**

   Claude Sonnet 4.5 имеет более лаконичный, прямой стиль общения и требует явного направления. Ознакомьтесь с [лучшими практиками инженерии подсказок Claude 4](/docs/ru/build-with-claude/prompt-engineering/claude-4-best-practices) для получения рекомендаций по оптимизации.

9. **Рассмотрите возможность включения расширенного мышления для сложных задач**

   Включите [расширенное мышление](/docs/ru/build-with-claude/extended-thinking) для значительного улучшения производительности при выполнении задач кодирования и рассуждения (отключено по умолчанию):

   ```python
   response = client.messages.create(
       model="claude-sonnet-4-5-20250929",
       max_tokens=16000,
       thinking={"type": "enabled", "budget_tokens": 10000},
       messages=[...]
   )
   ```

   <Note>
   Расширенное мышление влияет на эффективность [кэширования подсказок](/docs/ru/build-with-claude/prompt-caching#caching-with-thinking-blocks).
   </Note>

10. **Протестируйте вашу реализацию**

   Протестируйте в среде разработки перед развёртыванием в производство, чтобы убедиться, что все критические изменения обработаны надлежащим образом.

### Контрольный список миграции Sonnet 3.7 → 4.5

- [ ] Обновите ID модели на `claude-sonnet-4-5-20250929`
- [ ] **КРИТИЧЕСКОЕ**: Обновите параметры выборки, чтобы использовать только `temperature` ИЛИ `top_p`, но не оба
- [ ] Обработайте новую причину остановки `refusal` в вашем приложении
- [ ] **КРИТИЧЕСКОЕ**: Обновите инструмент текстового редактора на `text_editor_20250728` и `str_replace_based_edit_tool` (если применимо)
- [ ] **КРИТИЧЕСКОЕ**: Удалите любой код, использующий команду `undo_edit` (если применимо)
- [ ] Обновите инструмент выполнения кода на `code_execution_20250825` (если применимо)
- [ ] Удалите заголовок бета-версии `token-efficient-tools-2025-02-19` (если применимо)
- [ ] Удалите заголовок бета-версии `output-128k-2025-02-19` (если применимо)
- [ ] Проверьте и обновите подсказки в соответствии с [лучшими практиками Claude 4](/docs/ru/build-with-claude/prompt-engineering/claude-4-best-practices)
- [ ] Рассмотрите возможность включения расширенного мышления для сложных задач рассуждения
- [ ] Обработайте причину остановки `model_context_window_exceeded` (специфично для Sonnet 4.5)
- [ ] Рассмотрите возможность включения инструмента памяти для долгосрочных агентов (бета-версия)
- [ ] Рассмотрите возможность использования автоматического очищения вызовов инструментов для редактирования контекста (бета-версия)
- [ ] Протестируйте в среде разработки перед развёртыванием в производство

### Функции, удалённые из Claude Sonnet 3.7

- **Экономное использование инструментов**: Заголовок бета-версии `token-efficient-tools-2025-02-19` работает только с Claude 3.7 Sonnet и не поддерживается в моделях Claude 4 (см. шаг 6)
- **Расширенный вывод**: Заголовок бета-версии `output-128k-2025-02-19` не поддерживается (см. шаг 7)

Оба заголовка могут быть включены в запросы Claude 4, но не будут иметь никакого эффекта.

## Миграция с Claude Haiku 3.5 на Claude Haiku 4.5

Claude Haiku 4.5 — это наша самая быстрая и интеллектуальная модель Haiku с производительностью, близкой к передовой, обеспечивающая качество премиум-модели с производительностью реального времени для интерактивных приложений и высокообъёмной интеллектуальной обработки. Эта миграция включает несколько критических изменений, которые требуют обновления вашей реализации.

Полный обзор новых возможностей см. в [Что нового в Claude 4.5](/docs/ru/about-claude/models/whats-new-claude-4-5#key-improvements-in-haiku-4-5-over-haiku-3-5).

<Note>
Цена Haiku 4.5 составляет $1 за миллион входных токенов, $5 за миллион выходных токенов. Подробности см. в [Цены Claude](/docs/ru/about-claude/pricing).
</Note>

### Шаги миграции

1. **Обновите имя модели:**
   ```python
   # До (Haiku 3.5)
   model="claude-3-5-haiku-20241022"

   # После (Haiku 4.5)
   model="claude-haiku-4-5-20251001"
   ```

2. **Обновите версии инструментов (если применимо)**

   <Warning>
   Это критическое изменение по сравнению с Claude Haiku 3.5.
   </Warning>

   Haiku 4.5 поддерживает только последние версии инструментов:

   ```python
   # До (Haiku 3.5)
   tools=[{"type": "text_editor_20250124", "name": "str_replace_editor"}]

   # После (Haiku 4.5)
   tools=[{"type": "text_editor_20250728", "name": "str_replace_based_edit_tool"}]
   ```

   - **Текстовый редактор**: Используйте `text_editor_20250728` и `str_replace_based_edit_tool`
   - **Выполнение кода**: Используйте `code_execution_20250825`
   - Удалите любой код, использующий команду `undo_edit`

3. **Обновите параметры выборки**

   <Warning>
   Это критическое изменение по сравнению с Claude Haiku 3.5.
   </Warning>

   Используйте только `temperature` ИЛИ `top_p`, но не оба одновременно:

   ```python
   # До (Haiku 3.5) - Это вызовет ошибку в Haiku 4.5
   response = client.messages.create(
       model="claude-3-5-haiku-20241022",
       temperature=0.7,
       top_p=0.9,  # Невозможно использовать оба
       ...
   )

   # После (Haiku 4.5)
   response = client.messages.create(
       model="claude-haiku-4-5-20251001",
       temperature=0.7,  # Используйте temperature ИЛИ top_p, но не оба
       ...
   )
   ```

4. **Проверьте новые ограничения скорости**

   Haiku 4.5 имеет отдельные ограничения скорости от Haiku 3.5. Подробности см. в [документации об ограничениях скорости](/docs/ru/api/rate-limits).

5. **Обработайте новую причину остановки `refusal`**

   Обновите ваше приложение для [обработки причин остановки отказа](/docs/ru/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals).

6. **Рассмотрите возможность включения расширенного мышления для сложных задач**

   Включите [расширенное мышление](/docs/ru/build-with-claude/extended-thinking) для значительного улучшения производительности при выполнении задач кодирования и рассуждения (отключено по умолчанию):

   ```python
   response = client.messages.create(
       model="claude-haiku-4-5-20251001",
       max_tokens=16000,
       thinking={"type": "enabled", "budget_tokens": 5000},
       messages=[...]
   )
   ```
   <Note>
   Расширенное мышление влияет на эффективность [кэширования подсказок](/docs/ru/build-with-claude/prompt-caching#caching-with-thinking-blocks).
   </Note>

7. **Изучите новые возможности**

   Подробности об осведомлённости о контексте, увеличенной ёмкости вывода (64K токенов), повышенной интеллектуальности и улучшенной скорости см. в [Что нового в Claude 4.5](/docs/ru/about-claude/models/whats-new-claude-4-5#key-improvements-in-haiku-4-5-over-haiku-3-5).

8. **Протестируйте вашу реализацию**

   Протестируйте в среде разработки перед развёртыванием в производство, чтобы убедиться, что все критические изменения обработаны надлежащим образом.

### Контрольный список миграции Haiku 3.5 → 4.5

- [ ] Обновите ID модели на `claude-haiku-4-5-20251001`
- [ ] **КРИТИЧЕСКОЕ**: Обновите версии инструментов на последние (например, `text_editor_20250728`, `code_execution_20250825`) — устаревшие версии не поддерживаются
- [ ] **КРИТИЧЕСКОЕ**: Удалите любой код, использующий команду `undo_edit` (если применимо)
- [ ] **КРИТИЧЕСКОЕ**: Обновите параметры выборки, чтобы использовать только `temperature` ИЛИ `top_p`, но не оба
- [ ] Проверьте и отрегулируйте новые ограничения скорости (отдельные от Haiku 3.5)
- [ ] Обработайте новую причину остановки `refusal` в вашем приложении
- [ ] Рассмотрите возможность включения расширенного мышления для сложных задач рассуждения (новая возможность)
- [ ] Используйте осведомлённость о контексте для лучшего управления токенами в длительных сеансах
- [ ] Подготовьтесь к большим ответам (максимальный вывод увеличен с 8K на 64K токенов)
- [ ] Проверьте и обновите подсказки в соответствии с [лучшими практиками Claude 4](/docs/ru/build-with-claude/prompt-engineering/claude-4-best-practices)
- [ ] Протестируйте в среде разработки перед развёртыванием в производство

## Выбор между Sonnet 4.5 и Haiku 4.5

Как Claude Sonnet 4.5, так и Claude Haiku 4.5 — это мощные модели Claude 4 с разными сильными сторонами:

### Выберите Claude Sonnet 4.5 (самая интеллектуальная) для:

- **Сложное рассуждение и анализ**: Лучшая в своём классе интеллектуальность для сложных задач
- **Долгосрочные автономные агенты**: Превосходная производительность для агентов, работающих независимо в течение длительных периодов
- **Продвинутые задачи кодирования**: Наша самая мощная модель кодирования с продвинутым планированием и инженерией безопасности
- **Рабочие процессы с большим контекстом**: Улучшенное управление контекстом с инструментом памяти и возможностями редактирования контекста
- **Задачи, требующие максимальных возможностей**: Когда интеллектуальность и точность — главные приоритеты

### Выберите Claude Haiku 4.5 (самая быстрая и интеллектуальная Haiku) для:

- **Приложения реального времени**: Быстрое время отклика для интерактивного пользовательского опыта с производительностью, близкой к передовой
- **Высокообъёмная интеллектуальная обработка**: Экономичная интеллектуальность в масштабе с улучшенной скоростью
- **Развёртывания, чувствительные к стоимости**: Производительность, близкая к передовой, по более низким ценам
- **Архитектуры с подагентами**: Быстрые, интеллектуальные агенты для многоагентных систем
- **Компьютерное использование в масштабе**: Экономичная автоматизация рабочего стола и браузера
- **Задачи, требующие скорости**: Когда низкая задержка критична при сохранении интеллектуальности, близкой к передовой

### Рекомендации по расширенному мышлению

Модели Claude 4, в частности Sonnet и Haiku 4.5, показывают значительное улучшение производительности при использовании [расширенного мышления](/docs/ru/build-with-claude/extended-thinking) для задач кодирования и сложного рассуждения. Расширенное мышление **отключено по умолчанию**, но мы рекомендуем включать его для требовательной работы.

**Важно**: Расширенное мышление влияет на эффективность [кэширования подсказок](/docs/ru/build-with-claude/prompt-caching#caching-with-thinking-blocks). Когда содержимое, не являющееся результатом инструмента, добавляется в разговор, блоки мышления удаляются из кэша, что может увеличить затраты в многооборотных разговорах. Мы рекомендуем включать мышление, когда преимущества производительности перевешивают компромисс кэширования.

## Другие сценарии миграции

Основные пути миграции, описанные выше (Sonnet 3.7 → 4.5 и Haiku 3.5 → 4.5), представляют наиболее распространённые обновления. Однако вы можете выполнять миграцию с других моделей Claude на Claude 4.5. Этот раздел охватывает эти сценарии.

### Миграция с Claude Sonnet 4 → Sonnet 4.5

**Критическое изменение**: Невозможно указать одновременно `temperature` и `top_p` в одном запросе.

Все остальные вызовы API будут работать без изменений. Обновите ID модели и отрегулируйте параметры выборки при необходимости:

```python
# До (Claude Sonnet 4)
model="claude-sonnet-4-20250514"

# После (Claude Sonnet 4.5)
model="claude-sonnet-4-5-20250929"
```

### Миграция с Claude Opus 4.1 → Sonnet 4.5

**Нет критических изменений.** Все вызовы API будут работать без изменений.

Просто обновите ID модели:

```python
# До (Claude Opus 4.1)
model="claude-opus-4-1-20250805"

# После (Claude Sonnet 4.5)
model="claude-sonnet-4-5-20250929"
```

Claude Sonnet 4.5 — это наша самая интеллектуальная модель с лучшими в своём классе возможностями рассуждения, кодирования и долгосрочных агентов. Она предлагает превосходную производительность по сравнению с Opus 4.1 для большинства вариантов использования.

### Миграция с Claude Opus 4.1 → Opus 4.5

**Нет критических изменений.** Все вызовы API будут работать без изменений.

Просто обновите ID модели:

```python
# До (Claude Opus 4.1)
model="claude-opus-4-1-20250805"

# После (Claude Opus 4.5)
model="claude-opus-4-5-20251101"
```

Claude Opus 4.5 — это наша самая интеллектуальная модель, сочетающая максимальные возможности с практической производительностью. Она отличается значительными улучшениями в области зрения, кодирования и компьютерного использования по более доступной цене, чем Opus 4.1. Идеально подходит для сложных специализированных задач и профессиональной разработки программного обеспечения.

<Note>
Для кодовых баз со множеством ссылок на модели доступен [плагин Claude Code](https://github.com/anthropics/claude-code/tree/main/plugins/claude-opus-4-5-migration) для автоматизации миграции на Opus 4.5.
</Note>

### Миграция между моделями Claude 4.5

**Нет критических изменений.** Все вызовы API будут работать без изменений.

Просто обновите ID модели.

## Нужна помощь?

- Проверьте нашу [документацию API](/docs/ru/api/overview) для получения подробных спецификаций
- Ознакомьтесь с [возможностями моделей](/docs/ru/about-claude/models/overview) для сравнения производительности
- Ознакомьтесь с [примечаниями к выпуску API](/docs/ru/release-notes/api) для обновлений API
- Свяжитесь с поддержкой, если у вас возникнут проблемы во время миграции