# Ограничения скорости

Чтобы предотвратить злоупотребление и управлять пропускной способностью нашего API, мы установили ограничения на объем использования Claude API организацией.

---

У нас есть два типа ограничений:

1. **Ограничения расходов** устанавливают максимальную ежемесячную стоимость, которую организация может потратить на использование API.
2. **Ограничения скорости** устанавливают максимальное количество запросов API, которые организация может сделать за определенный период времени.

Мы применяем установленные сервисом ограничения на уровне организации, но вы также можете установить настраиваемые пользователем ограничения для рабочих пространств вашей организации.

Эти ограничения применяются как к использованию Standard, так и Priority Tier. Для получения дополнительной информации о Priority Tier, который предлагает улучшенные уровни обслуживания в обмен на гарантированные расходы, см. [Service Tiers](/docs/ru/api/service-tiers).

## О наших ограничениях

* Ограничения разработаны для предотвращения злоупотребления API, при этом минимизируя влияние на типичные модели использования клиентами.
* Ограничения определяются **уровнем использования**, где каждый уровень связан с другим набором ограничений расходов и скорости.
* Ваша организация будет автоматически переходить на более высокие уровни по мере достижения определенных пороговых значений при использовании API.
  Ограничения устанавливаются на уровне организации. Вы можете увидеть ограничения вашей организации на [странице Ограничений](/settings/limits) в [Claude Console](/).
* Вы можете столкнуться с ограничениями скорости в течение более коротких интервалов времени. Например, скорость 60 запросов в минуту (RPM) может быть применена как 1 запрос в секунду. Короткие всплески запросов с большим объемом могут превысить ограничение скорости и привести к ошибкам ограничения скорости.
* Ограничения, описанные ниже, являются нашими ограничениями стандартного уровня. Если вы ищете более высокие, пользовательские ограничения или Priority Tier для улучшенных уровней обслуживания, свяжитесь с отделом продаж через [Claude Console](/settings/limits).
* Мы используем [алгоритм маркерного ведра](https://en.wikipedia.org/wiki/Token_bucket) для ограничения скорости. Это означает, что ваша пропускная способность постоянно пополняется до вашего максимального ограничения, а не сбрасывается в фиксированные интервалы.
* Все описанные здесь ограничения представляют максимально допустимое использование, а не гарантированные минимумы. Эти ограничения предназначены для снижения непреднамеренного перерасхода и обеспечения справедливого распределения ресурсов между пользователями.

## Ограничения расходов

Каждый уровень использования имеет ограничение на то, сколько вы можете потратить на API в течение каждого календарного месяца. После достижения ограничения расходов вашего уровня, пока вы не квалифицируетесь для следующего уровня, вам придется ждать до следующего месяца, чтобы снова использовать API.

Чтобы квалифицироваться для следующего уровня, вы должны выполнить требование по депозиту. Чтобы минимизировать риск переполнения вашего счета, вы не можете внести больше, чем ваше ежемесячное ограничение расходов.

### Требования для повышения уровня
<table>
  <thead>
    <tr>
      <th>Уровень использования</th>
      <th>Покупка кредитов</th>
      <th>Максимальная покупка кредитов</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Уровень 1</td>
      <td>\$5</td>
      <td>\$100</td>
    </tr>
    <tr>
      <td>Уровень 2</td>
      <td>\$40</td>
      <td>\$500</td>
    </tr>
    <tr>
      <td>Уровень 3</td>
      <td>\$200</td>
      <td>\$1,000</td>
    </tr>
    <tr>
      <td>Уровень 4</td>
      <td>\$400</td>
      <td>\$5,000</td>
    </tr>
    <tr>
      <td>Ежемесячное выставление счетов</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<Note>
**Покупка кредитов** показывает совокупные покупки кредитов (без налогов), необходимые для повышения на этот уровень. Вы повышаетесь немедленно при достижении порога.

**Максимальная покупка кредитов** ограничивает максимальную сумму, которую вы можете добавить на свой счет в одной транзакции, чтобы предотвратить переполнение счета.
</Note>

## Ограничения скорости

Наши ограничения скорости для Messages API измеряются в запросах в минуту (RPM), входных токенах в минуту (ITPM) и выходных токенах в минуту (OTPM) для каждого класса модели.
Если вы превысите какое-либо из ограничений скорости, вы получите [ошибку 429](/docs/ru/api/errors), описывающую, какое ограничение скорости было превышено, вместе с заголовком `retry-after`, указывающим, как долго ждать.

<Note>
Вы также можете столкнуться с ошибками 429 из-за ограничений ускорения на API, если ваша организация имеет резкое увеличение использования. Чтобы избежать ограничений ускорения, постепенно увеличивайте трафик и поддерживайте согласованные модели использования.
</Note>

### ITPM с учетом кэша

Многие поставщики API используют объединенное ограничение "токены в минуту" (TPM), которое может включать все токены, как кэшированные, так и некэшированные, входные и выходные. **Для большинства моделей Claude только некэшированные входные токены учитываются в ваших ограничениях скорости ITPM.** Это ключевое преимущество, которое делает наши ограничения скорости фактически выше, чем они могут показаться на первый взгляд.

Ограничения скорости ITPM оцениваются в начале каждого запроса, и оценка корректируется во время запроса, чтобы отразить фактическое количество использованных входных токенов.

Вот что учитывается в ITPM:
- `input_tokens` (токены после последней точки разрыва кэша) ✓ **Учитываются в ITPM**
- `cache_creation_input_tokens` (токены, записываемые в кэш) ✓ **Учитываются в ITPM**
- `cache_read_input_tokens` (токены, прочитанные из кэша) ✗ **НЕ учитываются в ITPM** для большинства моделей

<Note>
Поле `input_tokens` представляет только токены, которые появляются **после вашей последней точки разрыва кэша**, а не все входные токены в вашем запросе. Чтобы рассчитать общее количество входных токенов:

```
total_input_tokens = cache_read_input_tokens + cache_creation_input_tokens + input_tokens
```

Это означает, что когда у вас есть кэшированное содержимое, `input_tokens` обычно будет намного меньше, чем ваш общий ввод. Например, с кэшированным документом из 200K токенов и вопросом пользователя из 50 токенов вы увидите `input_tokens: 50`, хотя общий ввод составляет 200,050 токенов.

Для целей ограничения скорости на большинстве моделей только `input_tokens` + `cache_creation_input_tokens` учитываются в вашем ограничении ITPM, что делает [кэширование подсказок](/docs/ru/build-with-claude/prompt-caching) эффективным способом увеличить вашу эффективную пропускную способность.
</Note>

**Пример**: С ограничением ITPM в 2,000,000 и коэффициентом попадания кэша 80% вы можете эффективно обработать 10,000,000 общих входных токенов в минуту (2M некэшированных + 8M кэшированных), поскольку кэшированные токены не учитываются в вашем ограничении скорости.

<Note>
Некоторые более старые модели (отмеченные † в таблицах ограничений скорости ниже) также учитывают `cache_read_input_tokens` в ограничениях скорости ITPM.

Для всех моделей без маркера †, кэшированные входные токены не учитываются в ограничениях скорости и выставляются по сниженной ставке (10% от базовой цены входного токена). Это означает, что вы можете достичь значительно более высокой эффективной пропускной способности, используя [кэширование подсказок](/docs/ru/build-with-claude/prompt-caching).
</Note>

<Tip>
**Максимизируйте ваши ограничения скорости с помощью кэширования подсказок**

Чтобы максимально использовать ваши ограничения скорости, используйте [кэширование подсказок](/docs/ru/build-with-claude/prompt-caching) для повторяющегося содержимого, такого как:
- Системные инструкции и подсказки
- Большие контекстные документы
- Определения инструментов
- История разговора

С эффективным кэшированием вы можете драматически увеличить вашу фактическую пропускную способность без увеличения ваших ограничений скорости. Отслеживайте коэффициент попадания кэша на [странице Использования](/settings/usage), чтобы оптимизировать вашу стратегию кэширования.
</Tip>

Ограничения скорости OTPM оцениваются на основе `max_tokens` в начале каждого запроса, и оценка корректируется в конце запроса, чтобы отразить фактическое количество выходных токенов.
Если вы достигаете ограничений OTPM раньше, чем ожидалось, попробуйте уменьшить `max_tokens`, чтобы лучше приблизить размер ваших завершений.

Ограничения скорости применяются отдельно для каждой модели; поэтому вы можете использовать разные модели до их соответствующих ограничений одновременно.
Вы можете проверить ваши текущие ограничения скорости и поведение в [Claude Console](/settings/limits).

<Note>
Для запросов с длинным контекстом (>200K токенов) при использовании заголовка бета-версии `context-1m-2025-08-07` с Claude Sonnet 4.x применяются отдельные ограничения скорости. См. [Ограничения скорости для длинного контекста](#long-context-rate-limits) ниже.
</Note>

<Tabs>
<Tab title="Уровень 1">
| Модель                                                                                       | Максимум запросов в минуту (RPM) | Максимум входных токенов в минуту (ITPM) | Максимум выходных токенов в минуту (OTPM) |
| -------------------------------------------------------------------------------------------- | --------------------------------- | -------------------------------------- | --------------------------------------- |
| Claude Sonnet 4.x<sup>**</sup>                                                               | 50                                | 30,000                                 | 8,000                                   |
| Claude Sonnet 3.7 ([deprecated](/docs/ru/about-claude/model-deprecations))                   | 50                                | 20,000                                 | 8,000                                   |
| Claude Haiku 4.5                                                                             | 50                                | 50,000                                 | 10,000                                  |
| Claude Haiku 3.5 ([deprecated](/docs/ru/about-claude/model-deprecations))                    | 50                                | 50,000<sup>†</sup>                     | 10,000                                  |
| Claude Haiku 3                                                                               | 50                                | 50,000<sup>†</sup>                     | 10,000                                  |
| Claude Opus 4.x<sup>*</sup>                                                                  | 50                                | 30,000                                 | 8,000                                   |
| Claude Opus 3 ([deprecated](/docs/ru/about-claude/model-deprecations))                      | 50                                | 20,000<sup>†</sup>                     | 4,000                                   |

</Tab>
<Tab title="Уровень 2">
| Модель                                                                                       | Максимум запросов в минуту (RPM) | Максимум входных токенов в минуту (ITPM) | Максимум выходных токенов в минуту (OTPM) |
| -------------------------------------------------------------------------------------------- | --------------------------------- | -------------------------------------- | --------------------------------------- |
| Claude Sonnet 4.x<sup>**</sup>                                                               | 1,000                             | 450,000                                | 90,000                                  |
| Claude Sonnet 3.7 ([deprecated](/docs/ru/about-claude/model-deprecations))                   | 1,000                             | 40,000                                 | 16,000                                  |
| Claude Haiku 4.5                                                                             | 1,000                             | 450,000                                | 90,000                                  |
| Claude Haiku 3.5 ([deprecated](/docs/ru/about-claude/model-deprecations))                    | 1,000                             | 100,000<sup>†</sup>                    | 20,000                                  |
| Claude Haiku 3                                                                               | 1,000                             | 100,000<sup>†</sup>                    | 20,000                                  |
| Claude Opus 4.x<sup>*</sup>                                                                  | 1,000                             | 450,000                                | 90,000                                  |
| Claude Opus 3 ([deprecated](/docs/ru/about-claude/model-deprecations))                      | 1,000                             | 40,000<sup>†</sup>                     | 8,000                                   |

</Tab>
<Tab title="Уровень 3">
| Модель                                                                                       | Максимум запросов в минуту (RPM) | Максимум входных токенов в минуту (ITPM) | Максимум выходных токенов в минуту (OTPM) |
| -------------------------------------------------------------------------------------------- | --------------------------------- | -------------------------------------- | --------------------------------------- |
| Claude Sonnet 4.x<sup>**</sup>                                                               | 2,000                             | 800,000                                | 160,000                                 |
| Claude Sonnet 3.7 ([deprecated](/docs/ru/about-claude/model-deprecations))                   | 2,000                             | 80,000                                 | 32,000                                  |
| Claude Haiku 4.5                                                                             | 2,000                             | 1,000,000                              | 200,000                                 |
| Claude Haiku 3.5 ([deprecated](/docs/ru/about-claude/model-deprecations))                    | 2,000                             | 200,000<sup>†</sup>                    | 40,000                                  |
| Claude Haiku 3                                                                               | 2,000                             | 200,000<sup>†</sup>                    | 40,000                                  |
| Claude Opus 4.x<sup>*</sup>                                                                  | 2,000                             | 800,000                                | 160,000                                 |
| Claude Opus 3 ([deprecated](/docs/ru/about-claude/model-deprecations))                      | 2,000                             | 80,000<sup>†</sup>                     | 16,000                                  |

</Tab>
<Tab title="Уровень 4">
| Модель                                                                                       | Максимум запросов в минуту (RPM) | Максимум входных токенов в минуту (ITPM) | Максимум выходных токенов в минуту (OTPM) |
| -------------------------------------------------------------------------------------------- | --------------------------------- | -------------------------------------- | --------------------------------------- |
| Claude Sonnet 4.x<sup>**</sup>                                                               | 4,000                             | 2,000,000                              | 400,000                                 |
| Claude Sonnet 3.7 ([deprecated](/docs/ru/about-claude/model-deprecations))                   | 4,000                             | 200,000                                | 80,000                                  |
| Claude Haiku 4.5                                                                             | 4,000                             | 4,000,000                              | 800,000                                 |
| Claude Haiku 3.5 ([deprecated](/docs/ru/about-claude/model-deprecations))                    | 4,000                             | 400,000<sup>†</sup>                    | 80,000                                  |
| Claude Haiku 3                                                                               | 4,000                             | 400,000<sup>†</sup>                    | 80,000                                  |
| Claude Opus 4.x<sup>*</sup>                                                                  | 4,000                             | 2,000,000                              | 400,000                                 |
| Claude Opus 3 ([deprecated](/docs/ru/about-claude/model-deprecations))                      | 4,000                             | 400,000<sup>†</sup>                    | 80,000                                  |

</Tab>
<Tab title="Пользовательский">
Если вы ищете более высокие ограничения для корпоративного использования, свяжитесь с отделом продаж через [Claude Console](/settings/limits).
</Tab>
</Tabs>

_<sup>* - Ограничение скорости Opus 4.x является общим ограничением, которое применяется к объединенному трафику через Opus 4, Opus 4.1 и Opus 4.5.</sup>_

_<sup>** - Ограничение скорости Sonnet 4.x является общим ограничением, которое применяется к объединенному трафику через Sonnet 4 и Sonnet 4.5.</sup>_

_<sup>† - Ограничение учитывает `cache_read_input_tokens` в использовании ITPM.</sup>_

### Message Batches API

Message Batches API имеет свой собственный набор ограничений скорости, которые используются совместно всеми моделями. Они включают ограничение на запросы в минуту (RPM) для всех конечных точек API и ограничение на количество пакетных запросов, которые могут находиться в очереди обработки одновременно. "Пакетный запрос" здесь относится к части Message Batch. Вы можете создать Message Batch, содержащий тысячи пакетных запросов, каждый из которых учитывается в этом ограничении. Пакетный запрос считается частью очереди обработки, когда он еще не был успешно обработан моделью.

<Tabs>
<Tab title="Уровень 1">
| Максимум запросов в минуту (RPM) | Максимум пакетных запросов в очереди обработки | Максимум пакетных запросов на пакет |
| --------------------------------- | ------------------------------------------ | -------------------------------- |
| 50                                | 100,000                                    | 100,000                          |
</Tab>
<Tab title="Уровень 2">
| Максимум запросов в минуту (RPM) | Максимум пакетных запросов в очереди обработки | Максимум пакетных запросов на пакет |
| --------------------------------- | ------------------------------------------ | -------------------------------- |
| 1,000                             | 200,000                                    | 100,000                          |
</Tab>
<Tab title="Уровень 3">
| Максимум запросов в минуту (RPM) | Максимум пакетных запросов в очереди обработки | Максимум пакетных запросов на пакет |
| --------------------------------- | ------------------------------------------ | -------------------------------- |
| 2,000                             | 300,000                                    | 100,000                          |
</Tab>
<Tab title="Уровень 4">
| Максимум запросов в минуту (RPM) | Максимум пакетных запросов в очереди обработки | Максимум пакетных запросов на пакет |
| --------------------------------- | ------------------------------------------ | -------------------------------- |
| 4,000                             | 500,000                                    | 100,000                          |
</Tab>
<Tab title="Пользовательский">
Если вы ищете более высокие ограничения для корпоративного использования, свяжитесь с отделом продаж через [Claude Console](/settings/limits).
</Tab>
</Tabs>

### Ограничения скорости для длинного контекста

При использовании Claude Sonnet 4 и Sonnet 4.5 с [включенным окном контекста из 1M токенов](/docs/ru/build-with-claude/context-windows#1m-token-context-window) следующие выделенные ограничения скорости применяются к запросам, превышающим 200K токенов.

<Note>
Окно контекста из 1M токенов в настоящее время находится в бета-версии для организаций на уровне использования 4 и организаций с пользовательскими ограничениями скорости. Окно контекста из 1M токенов доступно только для Claude Sonnet 4 и Sonnet 4.5.
</Note>

<Tabs>
<Tab title="Уровень 4">
| Максимум входных токенов в минуту (ITPM) | Максимум выходных токенов в минуту (OTPM) |
| -------------------------------------- | --------------------------------------- |
| 1,000,000                              | 200,000                                 |
</Tab>
<Tab title="Пользовательский">
Для пользовательских ограничений скорости длинного контекста для корпоративного использования свяжитесь с отделом продаж через [Claude Console](/settings/limits).
</Tab>
</Tabs>

<Tip>
Чтобы максимально использовать окно контекста из 1M токенов с ограничениями скорости, используйте [кэширование подсказок](/docs/ru/build-with-claude/prompt-caching).
</Tip>

### Мониторинг ваших ограничений скорости в Console

Вы можете отслеживать использование ограничений скорости на странице [Использование](/settings/usage) [Claude Console](/). 

Помимо предоставления диаграмм токенов и запросов, страница Использование предоставляет две отдельные диаграммы ограничений скорости. Используйте эти диаграммы, чтобы увидеть, какой запас у вас есть для роста, когда вы можете достигать пиковое использование, лучше понять, какие ограничения скорости запросить, или как вы можете улучшить коэффициент кэширования. Диаграммы визуализируют ряд метрик для данного ограничения скорости (например, по модели):

- Диаграмма **Rate Limit - Input Tokens** включает:
  - Почасовой максимум некэшированных входных токенов в минуту
  - Ваше текущее ограничение скорости входных токенов в минуту
  - Коэффициент кэша для ваших входных токенов (т.е. процент входных токенов, прочитанных из кэша)
- Диаграмма **Rate Limit - Output Tokens** включает:
  - Почасовой максимум выходных токенов в минуту
  - Ваше текущее ограничение скорости выходных токенов в минуту

## Установка более низких ограничений для рабочих пространств

Чтобы защитить рабочие пространства в вашей организации от потенциального перерасхода, вы можете установить пользовательские ограничения расходов и скорости для каждого рабочего пространства.

Пример: Если ограничение вашей организации составляет 40,000 входных токенов в минуту и 8,000 выходных токенов в минуту, вы можете ограничить одно рабочее пространство до 30,000 общих токенов в минуту. Это защищает другие рабочие пространства от потенциального перерасхода и обеспечивает более справедливое распределение ресурсов в вашей организации. Оставшиеся неиспользованные токены в минуту (или больше, если это рабочее пространство не использует ограничение) затем доступны для использования другими рабочими пространствами.

Примечание:
- Вы не можете установить ограничения на рабочее пространство по умолчанию.
- Если не установлено, ограничения рабочего пространства соответствуют ограничению организации.
- Ограничения на уровне организации всегда применяются, даже если ограничения рабочего пространства в сумме больше.
- Поддержка ограничений входных и выходных токенов будет добавлена в рабочие пространства в будущем.

## Заголовки ответов

Ответ API включает заголовки, которые показывают вам применяемое ограничение скорости, текущее использование и когда ограничение будет сброшено.

Возвращаются следующие заголовки:

| Заголовок                                     | Описание                                                                                                                                     |
| --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `retry-after`                                 | Количество секунд, которое нужно ждать, прежде чем вы сможете повторить запрос. Более ранние повторные попытки будут неудачными.                                                      |
| `anthropic-ratelimit-requests-limit`          | Максимальное количество запросов, разрешенных в течение любого периода ограничения скорости.                                                                            |
| `anthropic-ratelimit-requests-remaining`      | Количество оставшихся запросов перед ограничением скорости.                                                                                     |
| `anthropic-ratelimit-requests-reset`          | Время, когда ограничение скорости запросов будет полностью пополнено, предоставленное в формате RFC 3339.                                                    |
| `anthropic-ratelimit-tokens-limit`            | Максимальное количество токенов, разрешенных в течение любого периода ограничения скорости.                                                                              |
| `anthropic-ratelimit-tokens-remaining`        | Количество оставшихся токенов (округлено до ближайшей тысячи) перед ограничением скорости.                                                     |
| `anthropic-ratelimit-tokens-reset`            | Время, когда ограничение скорости токенов будет полностью пополнено, предоставленное в формате RFC 3339.                                                      |
| `anthropic-ratelimit-input-tokens-limit`      | Максимальное количество входных токенов, разрешенных в течение любого периода ограничения скорости.                                                                        |
| `anthropic-ratelimit-input-tokens-remaining`  | Количество оставшихся входных токенов (округлено до ближайшей тысячи) перед ограничением скорости.                                               |
| `anthropic-ratelimit-input-tokens-reset`      | Время, когда ограничение скорости входных токенов будет полностью пополнено, предоставленное в формате RFC 3339.                                                |
| `anthropic-ratelimit-output-tokens-limit`     | Максимальное количество выходных токенов, разрешенных в течение любого периода ограничения скорости.                                                                       |
| `anthropic-ratelimit-output-tokens-remaining` | Количество оставшихся выходных токенов (округлено до ближайшей тысячи) перед ограничением скорости.                                              |
| `anthropic-ratelimit-output-tokens-reset`     | Время, когда ограничение скорости выходных токенов будет полностью пополнено, предоставленное в формате RFC 3339.                                               |
| `anthropic-priority-input-tokens-limit`       | Максимальное количество входных токенов Priority Tier, разрешенных в течение любого периода ограничения скорости. (Только Priority Tier)                                     |
| `anthropic-priority-input-tokens-remaining`   | Количество оставшихся входных токенов Priority Tier (округлено до ближайшей тысячи) перед ограничением скорости. (Только Priority Tier)            |
| `anthropic-priority-input-tokens-reset`       | Время, когда ограничение скорости входных токенов Priority Tier будет полностью пополнено, предоставленное в формате RFC 3339. (Только Priority Tier)             |
| `anthropic-priority-output-tokens-limit`      | Максимальное количество выходных токенов Priority Tier, разрешенных в течение любого периода ограничения скорости. (Только Priority Tier)                                    |
| `anthropic-priority-output-tokens-remaining`  | Количество оставшихся выходных токенов Priority Tier (округлено до ближайшей тысячи) перед ограничением скорости. (Только Priority Tier)           |
| `anthropic-priority-output-tokens-reset`      | Время, когда ограничение скорости выходных токенов Priority Tier будет полностью пополнено, предоставленное в формате RFC 3339. (Только Priority Tier)            |

Заголовки `anthropic-ratelimit-tokens-*` отображают значения для наиболее ограничивающего ограничения, которое в настоящее время действует. Например, если вы превысили ограничение токенов в минуту рабочего пространства, заголовки будут содержать значения ограничения скорости токенов в минуту рабочего пространства. Если ограничения рабочего пространства не применяются, заголовки вернут общее количество оставшихся токенов, где общее количество является суммой входных и выходных токенов. Этот подход обеспечивает видимость наиболее релевантного ограничения на ваше текущее использование API.