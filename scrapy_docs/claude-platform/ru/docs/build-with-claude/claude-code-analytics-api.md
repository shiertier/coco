# Claude Code Analytics API

Программный доступ к аналитике использования Claude Code вашей организации и метрикам производительности с помощью Claude Code Analytics Admin API.

---

<Tip>
**The Admin API is unavailable for individual accounts.** To collaborate with teammates and add members, set up your organization in **Console → Settings → Organization**.
</Tip>

Claude Code Analytics Admin API предоставляет программный доступ к ежедневным агрегированным метрикам использования для пользователей Claude Code, позволяя организациям анализировать производительность разработчиков и создавать пользовательские панели управления. Этот API заполняет пробел между нашей базовой [панелью аналитики](/claude-code) и сложной интеграцией OpenTelemetry.

Этот API позволяет вам лучше отслеживать, анализировать и оптимизировать внедрение Claude Code:

* **Анализ производительности разработчиков:** отслеживание сеансов, добавленных/удаленных строк кода, коммитов и запросов на слияние, созданных с помощью Claude Code
* **Метрики использования инструментов:** мониторинг показателей принятия и отклонения для различных инструментов Claude Code (Edit, Write, NotebookEdit)
* **Анализ затрат:** просмотр предполагаемых затрат и использования токенов, разбитых по моделям Claude
* **Пользовательские отчеты:** экспорт данных для создания панелей управления и отчетов для руководства
* **Обоснование использования:** предоставление метрик для обоснования и расширения внедрения Claude Code внутри организации

<Check>
  **Требуется ключ Admin API**
  
  Этот API является частью [Admin API](/docs/ru/build-with-claude/administration-api). Эти конечные точки требуют ключ Admin API (начинающийся с `sk-ant-admin...`), который отличается от стандартных ключей API. Только члены организации с ролью администратора могут создавать ключи Admin API через [Claude Console](/settings/admin-keys).
</Check>

## Быстрый старт

Получите аналитику Claude Code вашей организации за конкретный день:

```bash
curl "https://api.anthropic.com/v1/organizations/usage_report/claude_code?\
starting_at=2025-09-08&\
limit=20" \
  --header "anthropic-version: 2023-06-01" \
  --header "x-api-key: $ADMIN_API_KEY"
```

<Tip>
  **Установите заголовок User-Agent для интеграций**
  
  Если вы создаете интеграцию, установите заголовок User-Agent, чтобы помочь нам понять закономерности использования:
  ```
  User-Agent: YourApp/1.0.0 (https://yourapp.com)
  ```
</Tip>

## Claude Code Analytics API

Отслеживайте использование Claude Code, метрики производительности и активность разработчиков в вашей организации с помощью конечной точки `/v1/organizations/usage_report/claude_code`.

### Ключевые концепции

- **Ежедневная агрегация**: возвращает метрики за один день, указанный параметром `starting_at`
- **Данные на уровне пользователя**: каждая запись представляет активность одного пользователя за указанный день
- **Метрики производительности**: отслеживание сеансов, строк кода, коммитов, запросов на слияние и использования инструментов
- **Данные о токенах и затратах**: мониторинг использования и предполагаемых затрат, разбитых по моделям Claude
- **Постраничная навигация на основе курсора**: обработка больших наборов данных со стабильной постраничной навигацией с использованием непрозрачных курсоров
- **Свежесть данных**: метрики доступны с задержкой до 1 часа для обеспечения согласованности

Для полной информации о параметрах и схемах ответов см. [справочник Claude Code Analytics API](/docs/ru/api/admin-api/claude-code/get-claude-code-usage-report).

### Базовые примеры

#### Получение аналитики за конкретный день

```bash
curl "https://api.anthropic.com/v1/organizations/usage_report/claude_code?\
starting_at=2025-09-08" \
  --header "anthropic-version: 2023-06-01" \
  --header "x-api-key: $ADMIN_API_KEY"
```

#### Получение аналитики с постраничной навигацией

```bash
# Первый запрос
curl "https://api.anthropic.com/v1/organizations/usage_report/claude_code?\
starting_at=2025-09-08&\
limit=20" \
  --header "anthropic-version: 2023-06-01" \
  --header "x-api-key: $ADMIN_API_KEY"

# Последующий запрос с использованием курсора из ответа
curl "https://api.anthropic.com/v1/organizations/usage_report/claude_code?\
starting_at=2025-09-08&\
page=page_MjAyNS0wNS0xNFQwMDowMDowMFo=" \
  --header "anthropic-version: 2023-06-01" \
  --header "x-api-key: $ADMIN_API_KEY"
```

### Параметры запроса

| Параметр | Тип | Обязательный | Описание |
|-----------|------|----------|-------------|
| `starting_at` | string | Да | Дата в формате UTC YYYY-MM-DD. Возвращает метрики только за этот день |
| `limit` | integer | Нет | Количество записей на странице (по умолчанию: 20, максимум: 1000) |
| `page` | string | Нет | Непрозрачный токен курсора из поля `next_page` предыдущего ответа |

### Доступные метрики

Каждая запись ответа содержит следующие метрики для одного пользователя в один день:

#### Измерения
- **date**: дата в формате RFC 3339 (временная метка UTC)
- **actor**: пользователь или ключ API, который выполнил действия Claude Code (либо `user_actor` с `email_address`, либо `api_actor` с `api_key_name`)
- **organization_id**: UUID организации
- **customer_type**: тип учетной записи клиента (`api` для клиентов API, `subscription` для клиентов Pro/Team)
- **terminal_type**: тип терминала или среды, где использовался Claude Code (например, `vscode`, `iTerm.app`, `tmux`)

#### Основные метрики
- **num_sessions**: количество отдельных сеансов Claude Code, инициированных этим пользователем
- **lines_of_code.added**: общее количество строк кода, добавленных Claude Code во все файлы
- **lines_of_code.removed**: общее количество строк кода, удаленных Claude Code из всех файлов
- **commits_by_claude_code**: количество коммитов git, созданных через функцию коммитов Claude Code
- **pull_requests_by_claude_code**: количество запросов на слияние, созданных через функцию PR Claude Code

#### Метрики действий инструментов
Разбивка показателей принятия и отклонения действий инструментов по типам инструментов:
- **edit_tool.accepted/rejected**: количество предложений инструмента Edit, которые пользователь принял/отклонил
- **write_tool.accepted/rejected**: количество предложений инструмента Write, которые пользователь принял/отклонил
- **notebook_edit_tool.accepted/rejected**: количество предложений инструмента NotebookEdit, которые пользователь принял/отклонил

#### Разбивка по моделям
Для каждой используемой модели Claude:
- **model**: идентификатор модели Claude (например, `claude-sonnet-4-5-20250929`)
- **tokens.input/output**: количество входных и выходных токенов для этой модели
- **tokens.cache_read/cache_creation**: использование токенов, связанных с кэшем, для этой модели
- **estimated_cost.amount**: предполагаемая стоимость в центах USD для этой модели
- **estimated_cost.currency**: код валюты для суммы стоимости (в настоящее время всегда `USD`)

### Структура ответа

API возвращает данные в следующем формате:

```json
{
  "data": [
    {
      "date": "2025-09-01T00:00:00Z",
      "actor": {
        "type": "user_actor",
        "email_address": "developer@company.com"
      },
      "organization_id": "dc9f6c26-b22c-4831-8d01-0446bada88f1",
      "customer_type": "api",
      "terminal_type": "vscode",
      "core_metrics": {
        "num_sessions": 5,
        "lines_of_code": {
          "added": 1543,
          "removed": 892
        },
        "commits_by_claude_code": 12,
        "pull_requests_by_claude_code": 2
      },
      "tool_actions": {
        "edit_tool": {
          "accepted": 45,
          "rejected": 5
        },
        "multi_edit_tool": {
          "accepted": 12,
          "rejected": 2
        },
        "write_tool": {
          "accepted": 8,
          "rejected": 1
        },
        "notebook_edit_tool": {
          "accepted": 3,
          "rejected": 0
        }
      },
      "model_breakdown": [
        {
          "model": "claude-sonnet-4-5-20250929",
          "tokens": {
            "input": 100000,
            "output": 35000,
            "cache_read": 10000,
            "cache_creation": 5000
          },
          "estimated_cost": {
            "currency": "USD",
            "amount": 1025
          }
        }
      ]
    }
  ],
  "has_more": false,
  "next_page": null
}
```

## Постраничная навигация

API поддерживает постраничную навигацию на основе курсора для организаций с большим количеством пользователей:

1. Сделайте начальный запрос с необязательным параметром `limit`
2. Если `has_more` имеет значение `true` в ответе, используйте значение `next_page` в следующем запросе
3. Продолжайте, пока `has_more` не будет `false`

Курсор кодирует позицию последней записи и обеспечивает стабильную постраничную навигацию даже при поступлении новых данных. Каждый сеанс постраничной навигации поддерживает согласованную границу данных, чтобы вы не пропустили и не дублировали записи.

## Распространенные варианты использования

- **Панели управления для руководства**: создание высокоуровневых отчетов, показывающих влияние Claude Code на скорость разработки
- **Сравнение инструментов AI**: экспорт метрик для сравнения Claude Code с другими инструментами кодирования AI, такими как Copilot и Cursor
- **Анализ производительности разработчиков**: отслеживание метрик производительности отдельных разработчиков и команд с течением времени
- **Отслеживание затрат и распределение**: мониторинг закономерностей расходов и распределение затрат по командам или проектам
- **Мониторинг внедрения**: определение, какие команды и пользователи получают наибольшую ценность от Claude Code
- **Обоснование ROI**: предоставление конкретных метрик для обоснования и расширения внедрения Claude Code внутри организации

## Часто задаваемые вопросы

### Насколько свежи данные аналитики?
Данные аналитики Claude Code обычно появляются в течение 1 часа после завершения активности пользователя. Чтобы обеспечить согласованные результаты постраничной навигации, в ответы включаются только данные старше 1 часа.

### Могу ли я получить метрики в реальном времени?
Нет, этот API предоставляет только ежедневные агрегированные метрики. Для мониторинга в реальном времени рассмотрите использование [интеграции OpenTelemetry](https://code.claude.com/docs/en/monitoring-usage).

### Как пользователи идентифицируются в данных?
Пользователи идентифицируются через поле `actor` двумя способами:
- **`user_actor`**: содержит `email_address` для пользователей, которые аутентифицируются через OAuth (наиболее распространено)
- **`api_actor`**: содержит `api_key_name` для пользователей, которые аутентифицируются через ключ API

Поле `customer_type` указывает, является ли использование от клиентов `api` (API PAYG) или клиентов `subscription` (планы Pro/Team).

### Какой период хранения данных?
Исторические данные аналитики Claude Code сохраняются и доступны через API. Для этих данных не указан период удаления.

### Какие развертывания Claude Code поддерживаются?
Этот API отслеживает только использование Claude Code на Claude API (1-я сторона). Использование на Amazon Bedrock, Google Vertex AI или других платформах третьих сторон не включено.

### Сколько стоит использование этого API?
Claude Code Analytics API бесплатен для всех организаций с доступом к Admin API.

### Как рассчитать показатели принятия инструментов?
Показатель принятия инструмента = `accepted / (accepted + rejected)` для каждого типа инструмента. Например, если инструмент Edit показывает 45 принятых и 5 отклоненных, показатель принятия составляет 90%.

### Какой часовой пояс используется для параметра date?
Все даты указаны в UTC. Параметр `starting_at` должен быть в формате YYYY-MM-DD и представляет полночь UTC для этого дня.

## См. также

Claude Code Analytics API помогает вам понять и оптимизировать рабочий процесс разработки вашей команды. Узнайте больше о связанных функциях:

- [Обзор Admin API](/docs/ru/build-with-claude/administration-api)
- [Справочник Admin API](/docs/ru/api/admin)
- [Панель аналитики Claude Code](/claude-code)
- [API использования и затрат](/docs/ru/build-with-claude/usage-cost-api) - отслеживание использования API во всех сервисах Anthropic
- [Управление идентификацией и доступом](https://code.claude.com/docs/en/iam)
- [Мониторинг использования с помощью OpenTelemetry](https://code.claude.com/docs/en/monitoring-usage) для пользовательских метрик и оповещений