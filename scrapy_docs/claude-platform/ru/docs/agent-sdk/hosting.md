# Размещение Agent SDK

Развертывание и размещение Claude Agent SDK в производственных средах

---

Claude Agent SDK отличается от традиционных stateless API LLM тем, что поддерживает состояние разговора и выполняет команды в постоянной среде. Это руководство охватывает архитектуру, соображения по размещению и лучшие практики для развертывания агентов на основе SDK в производстве.

<Info>
Для усиления безопасности сверх базовой изоляции — включая сетевые элементы управления, управление учетными данными и варианты изоляции — см. [Безопасное развертывание](/docs/ru/agent-sdk/secure-deployment).
</Info>

## Требования к размещению

### Изоляция на основе контейнеров

Для безопасности и изоляции SDK должен работать внутри изолированной среды контейнера. Это обеспечивает изоляцию процессов, ограничение ресурсов, управление сетью и эфемерные файловые системы.

SDK также поддерживает [программную конфигурацию песочницы](/docs/ru/agent-sdk/typescript#sandbox-settings) для выполнения команд.

### Системные требования

Каждый экземпляр SDK требует:

- **Зависимости среды выполнения**
  - Python 3.10+ (для Python SDK) или Node.js 18+ (для TypeScript SDK)
  - Node.js (требуется Claude Code CLI)
  - Claude Code CLI: `npm install -g @anthropic-ai/claude-code`

- **Выделение ресурсов**
  - Рекомендуется: 1 ГБ ОЗУ, 5 ГБ диска и 1 ЦП (варьируйте это в зависимости от вашей задачи по мере необходимости)

- **Сетевой доступ**
  - Исходящий HTTPS к `api.anthropic.com`
  - Опционально: доступ к серверам MCP или внешним инструментам

## Понимание архитектуры SDK

В отличие от stateless вызовов API, Claude Agent SDK работает как **долгоживущий процесс**, который:
- **Выполняет команды** в постоянной среде оболочки
- **Управляет файловыми операциями** в рабочем каталоге
- **Обрабатывает выполнение инструментов** с контекстом из предыдущих взаимодействий

## Варианты поставщиков песочницы

Несколько поставщиков специализируются на безопасных средах контейнеров для выполнения кода AI:

- **[Cloudflare Sandboxes](https://github.com/cloudflare/sandbox-sdk)**
- **[Modal Sandboxes](https://modal.com/docs/guide/sandbox)**
- **[Daytona](https://www.daytona.io/)**
- **[E2B](https://e2b.dev/)**
- **[Fly Machines](https://fly.io/docs/machines/)**
- **[Vercel Sandbox](https://vercel.com/docs/functions/sandbox)**

Для самостоятельно размещаемых вариантов (Docker, gVisor, Firecracker) и подробной конфигурации изоляции см. [Технологии изоляции](/docs/ru/agent-sdk/secure-deployment#isolation-technologies).

## Шаблоны развертывания в производстве

### Шаблон 1: Эфемерные сеансы

Создайте новый контейнер для каждой задачи пользователя, а затем уничтожьте его по завершении.

Лучше всего для одноразовых задач, пользователь может по-прежнему взаимодействовать с AI во время выполнения задачи, но после завершения контейнер уничтожается.

**Примеры:**
- Исследование и исправление ошибок: отладка и разрешение конкретной проблемы с соответствующим контекстом
- Обработка счетов: извлечение и структурирование данных из квитанций/счетов для систем бухгалтерского учета
- Задачи перевода: перевод документов или пакетов контента между языками
- Обработка изображений/видео: применение преобразований, оптимизаций или извлечение метаданных из файлов мультимедиа

### Шаблон 2: Долгоживущие сеансы

Поддерживайте постоянные экземпляры контейнеров для долгоживущих задач. Часто запускаются _несколько_ процессов Claude Agent внутри контейнера в зависимости от спроса.

Лучше всего для проактивных агентов, которые действуют без ввода пользователя, агентов, которые обслуживают контент, или агентов, которые обрабатывают большое количество сообщений.

**Примеры:**
- Email Agent: отслеживает входящие письма и автономно сортирует, отвечает или предпринимает действия на основе содержания
- Site Builder: размещает пользовательские веб-сайты для каждого пользователя с возможностью прямого редактирования через порты контейнера
- Высокочастотные чат-боты: обрабатывает непрерывные потоки сообщений с платформ, таких как Slack, где критичны быстрые времена отклика

### Шаблон 3: Гибридные сеансы

Эфемерные контейнеры, которые заполняются историей и состоянием, возможно, из базы данных или из функций возобновления сеанса SDK.

Лучше всего для контейнеров с прерывистым взаимодействием пользователя, которое запускает работу и завершается при завершении работы, но может быть продолжено.

**Примеры:**
- Personal Project Manager: помогает управлять текущими проектами с периодическими проверками, поддерживает контекст задач, решений и прогресса
- Deep Research: проводит многочасовые исследовательские задачи, сохраняет результаты и возобновляет расследование при возвращении пользователя
- Customer Support Agent: обрабатывает билеты поддержки, охватывающие несколько взаимодействий, загружает историю билетов и контекст клиента

### Шаблон 4: Одиночные контейнеры

Запустите несколько процессов Claude Agent SDK в одном глобальном контейнере.

Лучше всего для агентов, которые должны тесно сотрудничать. Это, вероятно, наименее популярный шаблон, потому что вам придется предотвращать перезапись агентами друг друга.

**Примеры:**
- **Симуляции**: агенты, которые взаимодействуют друг с другом в симуляциях, таких как видеоигры.

# Часто задаваемые вопросы

### Как мне общаться с моими песочницами?
При размещении в контейнерах открывайте порты для связи с экземплярами SDK. Ваше приложение может открывать конечные точки HTTP/WebSocket для внешних клиентов, пока SDK работает внутри контейнера.

### Какова стоимость размещения контейнера?
Мы обнаружили, что доминирующей стоимостью обслуживания агентов являются токены, контейнеры варьируются в зависимости от того, что вы подготавливаете, но минимальная стоимость составляет примерно 5 центов в час работы.

### Когда мне следует выключать неактивные контейнеры в сравнении с их поддержкой в активном состоянии?
Это, вероятно, зависит от поставщика, разные поставщики песочниц позволят вам установить различные критерии для тайм-аутов неактивности, после которых песочница может выключиться.
Вы захотите настроить этот тайм-аут на основе того, как часто вы думаете, что может быть ответ пользователя.

### Как часто мне следует обновлять Claude Code CLI?
Claude Code CLI версионируется с помощью semver, поэтому любые критические изменения будут версионированы.

### Как мне отслеживать здоровье контейнера и производительность агента?
Поскольку контейнеры — это просто серверы, та же инфраструктура логирования, которую вы используете для бэкенда, будет работать для контейнеров.

### Как долго может работать сеанс агента перед истечением времени ожидания?
Сеанс агента не будет истекать, но мы рекомендуем установить свойство 'maxTurns', чтобы предотвратить зацикливание Claude.

## Следующие шаги

- [Безопасное развертывание](/docs/ru/agent-sdk/secure-deployment) - сетевые элементы управления, управление учетными данными и усиление изоляции
- [TypeScript SDK - Параметры песочницы](/docs/ru/agent-sdk/typescript#sandbox-settings) - программная конфигурация песочницы
- [Руководство по сеансам](/docs/ru/agent-sdk/sessions) - узнайте об управлении сеансами
- [Разрешения](/docs/ru/agent-sdk/permissions) - конфигурация разрешений инструментов
- [Отслеживание затрат](/docs/ru/agent-sdk/cost-tracking) - мониторинг использования API
- [Интеграция MCP](/docs/ru/agent-sdk/mcp) - расширение с помощью пользовательских инструментов